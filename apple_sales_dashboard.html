<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apple Sales Dashboard - Plain JS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js for charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50">
  <div class="p-6 min-h-screen">
    <div class="mb-8">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900 mb-2">Apple Sales & Finance Analytics</h1>
          <p class="text-gray-600">Quarterly Business Review Dashboard</p>
        </div>
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2">
            <label class="text-sm font-medium text-gray-700">Quarter:</label>
            <select id="quarter-selector" class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white">
              <option value="Q2">Q2 2024</option>
              <option value="Q1">Q1 2024</option>
            </select>
          </div>
          <div class="flex items-center gap-2">
            <label class="text-sm font-medium text-gray-700">Region:</label>
            <select id="region-selector" class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white">
              <option value="All">All Regions</option>
              <option value="Americas">Americas</option>
              <option value="Europe">Europe</option>
              <option value="Asia Pacific">Asia Pacific</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div id="summary-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"></div>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
      <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Territory Performance vs Quota</h3>
        <canvas id="territory-bar-chart" height="300"></canvas>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Product Line Revenue</h3>
        <canvas id="product-bar-chart" height="300"></canvas>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Revenue by Sales Channel</h3>
        <canvas id="channel-pie-chart" height="300"></canvas>
      </div>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Data Quality Summary</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="flex items-center p-4 bg-green-50 rounded-lg">
          <span class="h-6 w-6 text-green-600 mr-3">âœ…</span>
          <div>
            <p class="font-medium text-green-900">Data Completeness</p>
            <p class="text-sm text-green-700">100% - All records have required fields</p>
          </div>
        </div>
        <div class="flex items-center p-4 bg-green-50 rounded-lg">
          <span class="h-6 w-6 text-green-600 mr-3">âœ…</span>
          <div>
            <p class="font-medium text-green-900">Revenue Reconciliation</p>
            <p class="text-sm text-green-700">Validated - No discrepancies found</p>
          </div>
        </div>
        <div class="flex items-center p-4 bg-blue-50 rounded-lg">
          <span class="h-6 w-6 text-blue-600 mr-3">ðŸ“¦</span>
          <div>
            <p class="font-medium text-blue-900">Data Freshness</p>
            <p class="text-sm text-blue-700">Updated - Current through <span id="data-freshness">Q2 2024</span></p>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-8 pt-6 border-t border-gray-200">
      <p class="text-sm text-gray-500">
        Generated for Apple Business Systems Analyst - Sales & Finance Analytics Team |
        Data Source: Snowflake Data Warehouse | Last Updated: June 2024
      </p>
    </div>
  </div>
  <script>
    // --- Sample Data Generation (same as before, but in plain JS) ---
    function generateSampleData() {
      const products = [
        { product_sku: 'IPHONE15PRO', product_name: 'iPhone 15 Pro', product_line: 'iPhone', category: 'Smartphones', cost_of_goods: 450 },
        { product_sku: 'IPHONE15', product_name: 'iPhone 15', product_line: 'iPhone', category: 'Smartphones', cost_of_goods: 350 },
        { product_sku: 'MACBOOKPRO14', product_name: 'MacBook Pro 14"', product_line: 'Mac', category: 'Laptops', cost_of_goods: 1200 },
        { product_sku: 'MACBOOKAIR15', product_name: 'MacBook Air 15"', product_line: 'Mac', category: 'Laptops', cost_of_goods: 800 },
        { product_sku: 'IPADPRO11', product_name: 'iPad Pro 11"', product_line: 'iPad', category: 'Tablets', cost_of_goods: 400 },
        { product_sku: 'AIRPODSPRO', product_name: 'AirPods Pro', product_line: 'AirPods', category: 'Audio', cost_of_goods: 120 },
        { product_sku: 'APPLEWATCH9', product_name: 'Apple Watch Series 9', product_line: 'Apple Watch', category: 'Wearables', cost_of_goods: 200 }
      ];
      const territories = [
        { territory_id: 'NAM-WEST', territory_name: 'North America West', region: 'Americas', sales_rep_id: 'REP001', quarterly_quota: 50000000 },
        { territory_id: 'NAM-EAST', territory_name: 'North America East', region: 'Americas', sales_rep_id: 'REP002', quarterly_quota: 45000000 },
        { territory_id: 'EUR-NORTH', territory_name: 'Europe North', region: 'Europe', sales_rep_id: 'REP003', quarterly_quota: 35000000 },
        { territory_id: 'EUR-SOUTH', territory_name: 'Europe South', region: 'Europe', sales_rep_id: 'REP004', quarterly_quota: 30000000 },
        { territory_id: 'APAC-JAPAN', territory_name: 'Asia Pacific Japan', region: 'Asia Pacific', sales_rep_id: 'REP005', quarterly_quota: 40000000 },
        { territory_id: 'APAC-CHINA', territory_name: 'Asia Pacific China', region: 'Asia Pacific', sales_rep_id: 'REP006', quarterly_quota: 60000000 }
      ];
      const salesChannels = [
        { channel_id: 'RETAIL', channel_name: 'Apple Store', channel_type: 'Retail', commission_rate: 0.05, fulfillment_cost_pct: 0.08 },
        { channel_id: 'ONLINE', channel_name: 'Apple.com', channel_type: 'Direct', commission_rate: 0.02, fulfillment_cost_pct: 0.12 },
        { channel_id: 'PARTNER', channel_name: 'Authorized Reseller', channel_type: 'Channel', commission_rate: 0.15, fulfillment_cost_pct: 0.05 },
        { channel_id: 'CARRIER', channel_name: 'Carrier Store', channel_type: 'Channel', commission_rate: 0.12, fulfillment_cost_pct: 0.03 }
      ];
      const salesTransactions = [];
      let transactionId = 1;
      function randomDate(start, end) {
        return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
      }
      territories.forEach(territory => {
        products.forEach(product => {
          salesChannels.forEach(channel => {
            // Q1 transactions (Jan-Mar 2024)
            const q1Transactions = Math.floor(Math.random() * 50) + 10;
            for (let i = 0; i < q1Transactions; i++) {
              const quantity = Math.floor(Math.random() * 5) + 1;
              const unitPrice = Math.floor(product.cost_of_goods * (1.8 + Math.random() * 0.8));
              salesTransactions.push({
                transaction_id: `TXN${transactionId++}`,
                product_sku: product.product_sku,
                channel: channel.channel_id,
                territory: territory.territory_id,
                transaction_date: randomDate(new Date('2024-01-01'), new Date('2024-03-31')).toISOString(),
                quantity: quantity,
                unit_price: unitPrice,
                total_amount: quantity * unitPrice,
                sales_rep_id: territory.sales_rep_id,
                customer_id: `CUST${Math.floor(Math.random() * 10000) + 1}`
              });
            }
            // Q2 transactions (Apr-Jun 2024)
            const growthFactor = 0.8 + Math.random() * 0.6;
            const q2Transactions = Math.floor(q1Transactions * growthFactor);
            for (let i = 0; i < q2Transactions; i++) {
              const quantity = Math.floor(Math.random() * 5) + 1;
              const unitPrice = Math.floor(product.cost_of_goods * (1.8 + Math.random() * 0.8));
              salesTransactions.push({
                transaction_id: `TXN${transactionId++}`,
                product_sku: product.product_sku,
                channel: channel.channel_id,
                territory: territory.territory_id,
                transaction_date: randomDate(new Date('2024-04-01'), new Date('2024-06-30')).toISOString(),
                quantity: quantity,
                unit_price: unitPrice,
                total_amount: quantity * unitPrice,
                sales_rep_id: territory.sales_rep_id,
                customer_id: `CUST${Math.floor(Math.random() * 10000) + 1}`
              });
            }
          });
        });
      });
      return { products, territories, salesChannels, salesTransactions };
    }

    // --- Dashboard Logic ---
    function updateDashboard() {
      const quarter = document.getElementById('quarter-selector').value;
      const region = document.getElementById('region-selector').value;
      const { products, territories, salesChannels, salesTransactions } = generateSampleData();
      // Filter transactions by quarter and region
      const quarterRange = quarter === 'Q1'
        ? [new Date('2024-01-01'), new Date('2024-04-01')]
        : [new Date('2024-04-01'), new Date('2024-07-01')];
      const filteredTransactions = salesTransactions.filter(t => {
        const date = new Date(t.transaction_date);
        const inQuarter = date >= quarterRange[0] && date < quarterRange[1];
        const inRegion = region === 'All' || territories.find(ter => ter.territory_id === t.territory).region === region;
        return inQuarter && inRegion;
      });
      // --- Summary Cards ---
      const territoryPerformance = territories.map(territory => {
        const territoryTxns = filteredTransactions.filter(t => t.territory === territory.territory_id);
        const grossRevenue = territoryTxns.reduce((sum, t) => sum + t.total_amount, 0);
        const totalCogs = territoryTxns.reduce((sum, t) => {
          const product = products.find(p => p.product_sku === t.product_sku);
          return sum + (t.quantity * (product ? product.cost_of_goods : 0));
        }, 0);
        const commissionCosts = territoryTxns.reduce((sum, t) => {
          const channel = salesChannels.find(c => c.channel_id === t.channel);
          return sum + (t.total_amount * (channel ? channel.commission_rate : 0));
        }, 0);
        const fulfillmentCosts = territoryTxns.reduce((sum, t) => {
          const channel = salesChannels.find(c => c.channel_id === t.channel);
          return sum + (t.total_amount * (channel ? channel.fulfillment_cost_pct : 0));
        }, 0);
        const netRevenue = grossRevenue - totalCogs - commissionCosts - fulfillmentCosts;
        const quotaAttainment = (grossRevenue / territory.quarterly_quota) * 100;
        return {
          ...territory,
          grossRevenue,
          netRevenue,
          netMargin: grossRevenue > 0 ? (netRevenue / grossRevenue) * 100 : 0,
          quotaAttainment,
          status: quotaAttainment >= 95 ? 'On Track' : quotaAttainment >= 80 ? 'At Risk' : 'Needs Attention',
          transactionCount: territoryTxns.length
        };
      });
      const totalRevenue = territoryPerformance.reduce((sum, t) => sum + t.grossRevenue, 0);
      const totalNetRevenue = territoryPerformance.reduce((sum, t) => sum + t.netRevenue, 0);
      const avgQuotaAttainment = territoryPerformance.reduce((sum, t) => sum + t.quotaAttainment, 0) / territoryPerformance.length;
      const totalTransactions = territoryPerformance.reduce((sum, t) => sum + t.transactionCount, 0);
      document.getElementById('summary-cards').innerHTML = `
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Total Revenue</p>
              <p class="text-2xl font-bold text-gray-900">$${(totalRevenue / 1000000).toFixed(1)}M</p>
            </div>
            <span class="h-8 w-8 text-green-600">ðŸ’µ</span>
          </div>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Net Revenue</p>
              <p class="text-2xl font-bold text-gray-900">$${(totalNetRevenue / 1000000).toFixed(1)}M</p>
            </div>
            <span class="h-8 w-8 text-blue-600">ðŸŽ¯</span>
          </div>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Avg Quota Attainment</p>
              <p class="text-2xl font-bold text-gray-900">${avgQuotaAttainment.toFixed(1)}%</p>
            </div>
            <span class="h-8 w-8 text-green-600">âœ…</span>
          </div>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Total Transactions</p>
              <p class="text-2xl font-bold text-gray-900">${totalTransactions.toLocaleString()}</p>
            </div>
            <span class="h-8 w-8 text-purple-600">ðŸ‘¥</span>
          </div>
        </div>
      `;
      // --- Charts ---
      // Territory Bar Chart
      const territoryLabels = territoryPerformance.map(t => t.territory_name.split(' ')[0] + ' ' + t.territory_name.split(' ')[1]);
      const grossRevenueData = territoryPerformance.map(t => Math.round(t.grossRevenue / 1000000));
      const netRevenueData = territoryPerformance.map(t => Math.round(t.netRevenue / 1000000));
      const quotaData = territoryPerformance.map(t => Math.round(t.quarterly_quota / 1000000));
      if (window.territoryBarChart) window.territoryBarChart.destroy();
      window.territoryBarChart = new Chart(document.getElementById('territory-bar-chart').getContext('2d'), {
        type: 'bar',
        data: {
          labels: territoryLabels,
          datasets: [
            { label: 'Gross Revenue', data: grossRevenueData, backgroundColor: '#007AFF' },
            { label: 'Net Revenue', data: netRevenueData, backgroundColor: '#34C759' },
            { label: 'Quota', data: quotaData, backgroundColor: '#FF9500', borderWidth: 1, borderColor: '#FF9500', type: 'line', fill: false }
          ]
        },
        options: { responsive: true, plugins: { legend: { position: 'top' } } }
      });
      // Product Bar Chart
      const productLinePerformance = {};
      products.forEach(product => {
        if (!productLinePerformance[product.product_line]) {
          productLinePerformance[product.product_line] = { revenue: 0, units: 0, transactions: 0 };
        }
        const productTxns = filteredTransactions.filter(t => t.product_sku === product.product_sku);
        productLinePerformance[product.product_line].revenue += productTxns.reduce((sum, t) => sum + t.total_amount, 0);
        productLinePerformance[product.product_line].units += productTxns.reduce((sum, t) => sum + t.quantity, 0);
        productLinePerformance[product.product_line].transactions += productTxns.length;
      });
      const productLabels = Object.keys(productLinePerformance);
      const productRevenueData = productLabels.map(line => Math.round(productLinePerformance[line].revenue / 1000000));
      if (window.productBarChart) window.productBarChart.destroy();
      window.productBarChart = new Chart(document.getElementById('product-bar-chart').getContext('2d'), {
        type: 'bar',
        data: {
          labels: productLabels,
          datasets: [
            { label: 'Revenue', data: productRevenueData, backgroundColor: '#AF52DE' }
          ]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });
      // Channel Pie Chart
      const channelPerformance = salesChannels.map(channel => {
        const channelTxns = filteredTransactions.filter(t => t.channel === channel.channel_id);
        const revenue = channelTxns.reduce((sum, t) => sum + t.total_amount, 0);
        return { ...channel, revenue };
      });
      const channelLabels = channelPerformance.map(c => c.channel_name);
      const channelRevenueData = channelPerformance.map(c => Math.round(c.revenue / 1000000));
      const channelColors = ['#007AFF', '#34C759', '#FF9500', '#AF52DE'];
      if (window.channelPieChart) window.channelPieChart.destroy();
      window.channelPieChart = new Chart(document.getElementById('channel-pie-chart').getContext('2d'), {
        type: 'pie',
        data: {
          labels: channelLabels,
          datasets: [
            { data: channelRevenueData, backgroundColor: channelColors }
          ]
        },
        options: { responsive: true, plugins: { legend: { position: 'top' } } }
      });
      // Data freshness
      document.getElementById('data-freshness').textContent = quarter + ' 2024';
    }
    document.getElementById('quarter-selector').addEventListener('change', updateDashboard);
    document.getElementById('region-selector').addEventListener('change', updateDashboard);
    window.onload = updateDashboard;
  </script>
</body>
</html> 